# キャッシュと静的アセットの運用メモ（ユーザー記述）

## 原文（ユーザーの言葉）
- 基本的に、静的ファイルはキャッシュしておきたい
- しかし、今回のように、キャッシュされたCSSが、参照するアセット(fontなど)が削除されたら、無限に404が表示され、CPUエラーになってしまう
-
- 対策としては、cssなど、キャッシュされる静的ファイルで、参照を行うファイルが、デプロイ時に削除された場合、警告とか、なんか開発者に知らせる仕組みを作る、
-
- もしくは、キャッシュを作成しない(これは採用しない。なぜなら、静的ファイルは基本的にキャッシュして、高速化に務めたいから)
-
- もしくは、デプロイごとにユーザーの端末に保存されるキャッシュを更新する
-
- もしくは、CSSなどをビルド時などに監視し、外部アセットがあれば、きちんと開発者に知らせて、削除する場合は気をつけてというメッセージを表示するとともに、内部データ(jsonとかconst.tsとか)で、外部アセットはこれが参照されている(参照パスとともに)。ビルドごとに、このパスが削除されていないか確認。
- → ない場合、今回のような404CPUエラーが発生する可能性が十分に高いので、戻すように警告し、また、戻すスクリプトも残しておく。(事前にバックアップを取っておく。)

## 修正後
- 基本的に、静的ファイルはキャッシュしておきたい
- しかし、今回のように、キャッシュされたCSSが参照するアセット（fontなど）が削除されたら、無限に404が表示され、CPUエラーになってしまう
-
- 対策としては、CSSなど、キャッシュされる静的ファイルで参照しているファイルが、デプロイ時に削除された場合、警告などで開発者に知らせる仕組みを作る
-
- もしくは、キャッシュを作成しない（これは採用しない。なぜなら、静的ファイルは基本的にキャッシュして、高速化に務めたいから）
-
- もしくは、デプロイごとにユーザーの端末に保存されるキャッシュを更新する
-
- もしくは、CSSなどをビルド時に監視し、外部アセットがあれば、きちんと開発者に知らせて、削除する場合は気をつけてというメッセージを表示するとともに、内部データ（jsonやconst.tsなど）で、外部アセットはこれが参照されている（参照パスとともに）。ビルドごとに、このパスが削除されていないか確認。
- → ない場合、今回のような404CPUエラーが発生する可能性が十分に高いので、戻すように警告し、また、戻すスクリプトも残しておく。（事前にバックアップを取っておく。）

## 修正箇所
1) 原文: 「キャッシュされたCSSが、参照するアセット(fontなど)が削除されたら」
   修正: 「キャッシュされたCSSが参照するアセット（fontなど）が削除されたら」
2) 原文: 「cssなど、キャッシュされる静的ファイルで、参照を行うファイルが、デプロイ時に削除された場合、警告とか、なんか開発者に知らせる仕組みを作る、」
   修正: 「CSSなど、キャッシュされる静的ファイルで参照しているファイルが、デプロイ時に削除された場合、警告などで開発者に知らせる仕組みを作る」
3) 原文: 「もしくは、キャッシュを作成しない(これは採用しない。なぜなら、静的ファイルは基本的にキャッシュして、高速化に務めたいから)」
   修正: 「もしくは、キャッシュを作成しない（これは採用しない。なぜなら、静的ファイルは基本的にキャッシュして、高速化に務めたいから）」
4) 原文: 「CSSなどをビルド時などに監視し」
   修正: 「CSSなどをビルド時に監視し」
5) 原文: 「内部データ(jsonとかconst.tsとか)」
   修正: 「内部データ（jsonやconst.tsなど）」
6) 原文: 「(事前にバックアップを取っておく。)」
   修正: 「（事前にバックアップを取っておく。）」
