---
title: "スレッド詳細のSSR/CSR切り分け方針"
date: "2026-02-02T15:20:00.000Z"
---

## スレッド詳細のSSR/CSR切り分け方針

### 目的
`/threads/[id]` の遷移に時間が掛かるが、UXで緩和したい。

### 背景
- TTFB(SSRレンダリング)が約500ms程。API処理時間が約200ms程。
    * つまり、API以外の処理(恐らく、Next.jsの**SSRの処理**)で時間がかかっている
- 現状、SSRで全てデータを取得、レンダリングする構成のため、**完全にレンダリングが完了するまで、画面が止まって見える**

?>SSRは処理(APIのフェッチ、レンダリングなど)が完了するまでHTMLが返らない。  
→ ユーザーは、画面が止まって見える。


?>(`loading.tsx`も一応使っているが、投稿高速表示のほうが何杯も大事だろう。)

### 方針
- **SSR**: タイトル/作成者/タグ/作成日時
- **CSR**: 投稿一覧

### 理由
* 現在の処理は、SSR側で全てデータを取得し、レンダリングしている。
    * (`getThreadWithPosts()`をfetchし、`.map()`でレンダリングするのに、恐らく処理時間が大きいと予測できる。)

* そこで、処理時間が大きいであろう上記の処理をSSRから除外して、CSRで処理を行うことで、SSRは高速にHTMLを返却でき、画面表示が高速化する。

→ **先に骨格(タイトルなど)だけ出し、重い部分(ポストの取得 & レンダリング)はCSRで後から表示**して体感を速くする。

### 具体例
1. `page.tsx`(SSR) は **スレッド本体のみ取得**
2. 投稿一覧は **クライアントで取得して後から表示**

### 分割の基準（SSR/CSRの判断軸）
**SSRに残すべきもの**
- 取得が軽い処理(HTMLを速く返却したい)
- SEO上重要なもの(タイトルや作成者など、クローラに検知させたい情報)

**CSRに回すべきもの**
- 取得が重い/遅い
- 後から表示しても画面が成立する


### 懸念
CSRで実行すると、クライアントによって(PC, モバイルなど)環境によって処理時間が異なる可能性がある。
### 次やること
- `ThreadDetail` を「ヘッダーSSR / 投稿CSR」に分割して実装する
